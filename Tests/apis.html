<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>API's Test</title>
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <!-- <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
</head>

<body>

  <label for="ingredients">Add your ingredients</label>
  <input id="ingredients" type="text">
  <input type="submit" value="submit" id="AddIngredients">

  <div id="recipies"></div>
  <div id="browseButton">
    <button id="lessButton">Less</button>
    <button id="moreButton">More</button>
  </div>

  <script type="text/javascript">
    var storeResponse;
    var countStart = 0;
    var countEnd = 10;

    var logic = {

      magicButton: function() {
        //Shows the more button while the countStart < 90.
        if (countStart === 0) {
          $("#browseButton").hide();
        } else if (countStart === 10) {
          $("#browseButton").show();
          $("#lessButton").hide();
        } else if (countStart >10 && countStart < 90) {
          $("#lessButton").show();
        } else { //Otherwhise hide it.
          $("#browseButton").hide();
        }
      },

      edamamGet: function() {

        //Returns countStart to 0
        countStart += 0;
        //Assign text typed by user to variable ingridients.
        var ingredients = $("#ingredients").val();
        //Default start of API Url
        var Uri = " https://api.edamam.com/search?q="
        //Default end of the API Url.
        var Api = "&app_id=951c44a9&app_key=10fce9b48db6f70dd8fec5472069d5f7&from=0&to=100"

        //Merge the start + the ingridients typed by user + the end of the API Url.
        var queryUrl = Uri + ingredients + Api;

        $("#ingredients").val("");

        //Using ajax to get the json that contains the recipies.
        $.ajax({
          url: queryUrl,
          method: "GET"
        }).then(function(response) { //Stores the JSON obtained in the temp variable "response"

          //Saves JSON response to local variable in case we need to use response in the future.
          storeResponse = response;

          //Clean textbox.

          console.log(storeResponse);
          //Calls the "printer"
          logic.printEdamam();
        })
      },

      printEdamam: function() {

        //Cleans DIV to show results.
        $("#recipies").empty();
        //Run for loop to print 10 recipies.
        for (countStart; countStart < countEnd; countStart++) {

          //Create link for 10 recipies inside a p tag.
          var pTag = $("<p>");
          var aTag = $("<a>");
          aTag.attr("href", storeResponse.hits[countStart].recipe.url)
          aTag.attr("target", "_blank");
          aTag.append("", storeResponse.hits[countStart].recipe.label);
          pTag.append(aTag);
          $("#recipies").append(pTag);
        }

        //Call function to check if show or hide the "more button"
        logic.magicButton();
      },

      moreRecipies: function() {
        countEnd += 10;
        logic.printEdamam();
      },

      lessRecipies: function() {
        countEnd -= 10;
        countStart -= 20;
        logic.printEdamam();
      }

    };

    //Execute the start function
    logic.magicButton();

    //Click on "Submit" button.
    $("#AddIngredients").on("click", function() {
      //Calls functoin to pull data from edamam API.
      logic.edamamGet();
    })

    $("#moreButton").on("click", function() {
      logic.moreRecipies(); //Calls printer to show 10 new recipes.
    });

    $("#lessButton").on("click", function() {
      logic.lessRecipies();
    })
  </script>

</body>

</html>
